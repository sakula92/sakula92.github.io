webpackJsonp([44],{"6MJU":function(t,e,i){"use strict";var s=i("bOdI"),n=i.n(s),a=i("woOf"),r=i.n(a),o=i("Dd8w"),c=i.n(o),l=i("Xxa5"),u=i.n(l),d=i("exGp"),p=i.n(d),h=i("NYxO"),m=i("DHvs"),f=Object(h.createNamespacedHelpers)("user").mapActions;e.a={data:function(){return{active:!1,isWexin:!1,unUsedNo:"0",beenUsedN:"0",pastDue:"0",index:"",startX:0,endX:0,coupons:[],isHaveTotal:"",hasCoupon:!1,newAgentCity:{},currentCityData:{}}},asyncData:function(){var t=p()(u.a.mark(function t(e){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{filter:{status:parseInt(e.query.status||1),limit:10}});case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),computed:c()({},Object(h.mapState)({user:function(t){return t.user},weal:function(t){return t.weal},agentCity:function(t){return t.session.agentCity},currentCity:function(t){return t.session.currentCity},locationInfo:function(t){return t.session.locationInfo}})),mounted:function(){this.isSelectCity=!1,window.sessionStorage.getItem("agent_city")&&(this.isSelectCity=!0),this.newAgentCity=window.sessionStorage.getItem("agent_city")?JSON.parse(window.sessionStorage.getItem("agent_city")):this.currentCity,this.currentCityData=window.localStorage.getItem("current_city")?JSON.parse(window.localStorage.getItem("current_city")):this.currentCity},watch:{filter:function(){var t=this;this.$nextTick(function(){t.$refs.loadMore.$refs.infiniteLoading.$emit("$InfiniteLoading:reset")})}},methods:c()({sensData:function(t){Object(m.l)(t)},changeUnion:function(t){this.coupons[t].channelTag=!this.coupons[t].channelTag,console.log(this.coupons[t].channel_status)},skip:function(){this.checkSlide()&&this.restSlide()},touchStart:function(t){this.startX=t.touches[0].clientX},touchEnd:function(t){var e=t.currentTarget.parentElement;this.endX=t.changedTouches[0].clientX,0==e.dataset.type&&this.startX-this.endX>30&&(this.restSlide(),e.dataset.type=1),1==e.dataset.type&&this.startX-this.endX<-30&&(this.restSlide(),e.dataset.type=0),this.startX=0,this.endX=0},checkSlide:function(){for(var t=document.querySelectorAll(".list-item"),e=0;e<t.length;e++)if(1==t[e].dataset.typpe)return!0;return!1},restSlide:function(){for(var t=document.querySelectorAll(".list-item"),e=0;e<t.length;e++)t[e].dataset.type=0},deleteItem:function(t){var e=this;weui.confirm("确认删除？",p()(u.a.mark(function i(){var s,n;return u.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,m.b.get("/red_coupon/couponDel",{ticket_id:t.TICKET_ID});case 2:s=i.sent,n=s.data,200===s.status&&"1"===n.status?(e.coupons=[],e.$nextTick(function(){e.$refs.loadMore.$refs.infiniteLoading.$emit("$InfiniteLoading:reset")})):n.msg&&weui.alert(n.msg,{title:"删除失败"});case 6:case"end":return i.stop()}},i,e)})))}},f({getWeal:"getWeal"}),{onFilter:function(t,e){this.coupons=[],this.isMore=!0,this.filter=r()({},this.filter,n()({},t,e))},toUseCoupon:function(t){Object(m.l)("fm_myRedPacketClickToUse"),this.newAgentCity=window.sessionStorage.getItem("agent_city")?JSON.parse(window.sessionStorage.getItem("agent_city")):this.currentCity,this.currentCityData=window.localStorage.getItem("current_city")?JSON.parse(window.localStorage.getItem("current_city")):this.currentCity;var e={};e=this.isSelectCity?this.newAgentCity:this.currentCityData;var i="";i=0==t.channel_status?"":1===t.direct||"1"===t.direct?"/directCoupon":"/",this.$router.push({path:i,query:{city_id:e.city_id,district_id:e.district_id,ticket_type:t.TICKET_TYPE}})},fetchMore:function(){var t=p()(u.a.mark(function t(){var e,i;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.b.get("/red_coupon/couponShow",r()({},this.filter,{offset:this.coupons.length}));case 2:return e=t.sent,i=e.data,e.status,i.data&&i.data.forEach(function(t,e){t.list.map(function(t){return t.channelTag=!1,t})}),this.isHaveTotal=i.data[this.filter.status-1],this.isHaveTotal&&this.isHaveTotal.total>0&&(this.coupons=this.coupons.concat(i.data[this.filter.status-1].list||[])),this.coupons.length&&(this.hasCoupon=!0),i.data.length>0&&(this.unUsedNo=i.data[0].total,this.beenUsedN=i.data[1].total,this.pastDue=i.data[2].total),t.abrupt("return",{length:this.coupons.length,isMore:(i.coupons||[]).length>=this.filter.limit});case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),onDelete:function(){var t=p()(u.a.mark(function t(e){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()})}},CpYm:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("6MJU"),n=i("VT8W"),a=!1;var r=function(t){a||i("jOOb")},o=i("VU/8")(s.a,n.a,!1,r,null,null);o.options.__file="pages/user/coupon.vue",e.default=o.exports},HuPf:function(t,e,i){t.exports=i.p+"img/useEnd.c9ca803.png"},NhaF:function(t,e,i){t.exports=i.p+"img/canUse.aaae462.png"},P9TZ:function(t,e,i){t.exports=i.p+"img/couponBg.eec18da.png"},"S+CF":function(t,e,i){var s=i("kxFB");(t.exports=i("FZ+f")(!1)).push([t.i,'.text-dec{text-decoration:none;color:#333}.list_ul{list-style:none;overflow:hidden;margin-right:.5rem}.list-item{position:relative;margin-top:.5rem;-webkit-transition:all .2s;transition:all .2s}.list-item[data-type="0"]{-webkit-transform:translateZ(0);transform:translateZ(0)}.list-item[data-type="1"]{-webkit-transform:translate3d(-5rem,0,0);transform:translate3d(-5rem,0,0)}.list-item .delete{width:5rem;height:5rem;background:#ff4949;font-size:.85rem;color:#fff;text-align:center;line-height:5rem;position:absolute;top:.3rem;right:-5.2rem}.tips{border-bottom-right-radius:.3125rem}.bgImgCoupon{background:url('+s(i("P9TZ"))+") no-repeat;background-size:102% 107%}.bgImgCoupon,.bgImgCouponEnd{-webkit-box-shadow:.3125rem .3125rem .03125rem #fff;box-shadow:.3125rem .3125rem .03125rem #fff}.bgImgCouponEnd{background:url("+s(i("HuPf"))+") no-repeat;background-size:102% 107%}.btn{border:.09375rem solid #ff9501}.icon{right:0;top:0;font-size:4.375rem;color:#b2b2b2}.bgPic,.icon{position:absolute}.bgPic{background:url("+s(i("NhaF"))+");background-size:100% 100%;display:inline-block;font-size:.8125rem;width:4.0625rem;height:2.1875rem;line-height:2.1875rem;text-align:center;top:1.5rem;color:#fff;right:.78125rem}.isUse{width:3.4375rem;height:1.5625rem;line-height:1.5625rem;background:url("+s(i("tI9c"))+");background-size:100% 100%;right:1.1875rem}.box3{position:relative}.box3.vip{background:url("+s(i("SmwT"))+') no-repeat;background-size:2.6rem 2rem}.box3:before{width:.625rem;height:.625rem;content:"";border-radius:50%;background:#f2f3f5;position:absolute;top:50%;margin-top:-.3125rem;left:-.3125rem}.box3.overdue:after{position:absolute;height:100%;content:"";border-right:.3125rem dotted #fff;right:-.125rem;top:0}.box4{width:3.125rem;position:relative}.box4:after{width:.625rem;height:.625rem;content:"";border-radius:50%;background:#f2f3f5;position:absolute;top:50%;margin-top:-.3125rem;right:-.3125rem}.box6{width:1.7rem;height:1.04rem;background:url('+s(i("TI6n"))+") no-repeat 50%/cover}.box7{text-indent:.3rem}.coupon-weixin{width:100%;border-top:.03125rem solid #f2f2f2;border-radius:0 0 .25rem .25rem;text-align:center;margin-left:.3125rem;font-size:.6875rem;height:2.1875rem;line-height:2.1875rem}",""])},SmwT:function(t,e,i){t.exports=i.p+"img/333.d9fefb0.png"},TI6n:function(t,e,i){t.exports=i.p+"img/icon-img.b0b9e31.png"},VT8W:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"flex-wrp flex-around size32 bg-white"},[i("nuxt-link",{staticClass:"block ptb30 text-dec",class:{"nav-active":1===t.filter.status},attrs:{to:{path:"/user_coupons",query:{status:1}},replace:!0},nativeOn:{click:function(e){t.onFilter("status",1),t.sensData("fm_myRedPacketClickUnuse")}}},[t._v("未使用("+t._s(t.unUsedNo)+")\n    ")]),i("nuxt-link",{staticClass:"block ptb30 text-dec",class:{"nav-active":2===t.filter.status},attrs:{to:{path:"/user_coupons",query:{status:2}},replace:!0},nativeOn:{click:function(e){t.onFilter("status",2),t.sensData("fm_myRedPacketClickUsed")}}},[t._v("已使用("+t._s(t.beenUsedN)+")\n    ")]),i("nuxt-link",{staticClass:"block ptb30 text-dec",class:{"nav-active":3===t.filter.status},attrs:{to:{path:"/user_coupons",query:{status:3}},replace:!0},nativeOn:{click:function(e){t.onFilter("status",3),t.sensData("fm_myRedPacketClickOverdue")}}},[t._v("已过期("+t._s(t.pastDue)+")\n    ")])],1),t.hasCoupon?i("div",[i("ul",{staticClass:"list_ul"},t._l(t.coupons,function(e,s){return i("li",{key:e.id,staticClass:"list-item",attrs:{"data-type":"0"}},[1==t.filter.status&&t.isHaveTotal.total&&t.isHaveTotal.total>0?i("div",[i("div",{staticClass:"bgImgCoupon",staticStyle:{height:"5rem",display:"flex"}},[i("div",{staticStyle:{color:"white",width:"6rem","text-align":"center"}},[i("div",{staticClass:"size40",staticStyle:{"padding-top":"0.625rem !important"}},[t._v("￥\n                "),i("span",{staticStyle:{"font-size":"1.7rem"}},[t._v(t._s(e.TICKET_AMOUNT))])]),i("div",{staticClass:"size24"},[t._v("满"+t._s(e.LOWEST_AMOUNT)+"可用")])]),i("div",{staticStyle:{width:"12rem","padding-left":"1.5rem"}},[i("div",{staticClass:"flex-wrp flex-align-center pl20",staticStyle:{"margin-top":".5rem"}},[i("div",{staticClass:"color2 size3 pt10 tips"},[i("span",{staticClass:"compulsory-row-one"},[t._v(t._s(e.TICKET_REMARK))])])]),i("div",{staticClass:"color5 size26 pt5 pl20"},[t._v("有效期至："+t._s(e.END_TIME.replace(/\//,"-").substring(0,7))+"-"+t._s(e.END_TIME.replace(/\//,"-").substring(8,11)))]),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.channel_status,expression:"!coupon.channel_status"}],staticClass:"size26 pl20 pt5 color44",on:{click:function(e){return t.changeUnion(s)}}},[t._v("当前渠道不可使用\n                "),e.channelTag?i("i",{staticClass:"z z-top size22 ml10"}):i("i",{staticClass:"z z-down size22 ml10"})])]),i("div",{staticStyle:{width:"4rem"},on:{click:function(i){return t.toUseCoupon(e)}}},[i("span",{staticClass:"bgPic",class:{isUse:!e.channel_status}},[t._v("去使用")])])]),e.channelTag?i("div",{staticClass:"coupon-weixin bg-white color44"},[8==e.channel_from?i("span",[t._v("该优惠券仅支持在中原银行手机银行APP使用。")]):9==e.channel_from?i("span",[t._v("该优惠券仅支持中原银行中原钱包APP使用。")]):t._e()]):t._e()]):t._e(),2==t.filter.status&&t.isHaveTotal.total&&t.isHaveTotal.total>0?i("div",{staticClass:"bgImgCouponEnd",staticStyle:{height:"5rem",display:"flex"},on:{touchstart:t.touchStart,touchend:t.touchEnd,click:t.skip}},[i("div",{staticStyle:{color:"white",width:"6rem","text-align":"center"}},[i("div",{staticClass:"size40",staticStyle:{"padding-top":"0.625rem !important"}},[t._v("￥\n              "),i("span",{staticStyle:{"font-size":"1.7rem"}},[t._v(t._s(e.TICKET_AMOUNT))])]),i("div",{staticClass:"size24"},[t._v("满"+t._s(e.LOWEST_AMOUNT)+"可用")])]),i("div",{staticStyle:{width:"12rem","padding-left":"1.5rem",color:"#CCCCCC"}},[i("div",{staticClass:"flex-wrp flex-align-center pl20",staticStyle:{"margin-top":".5rem"}},[i("div",{staticClass:"size3 ptb20 tips"},[i("span",{staticClass:"compulsory-row-one"},[t._v(t._s(e.TICKET_REMARK))])])]),i("div",{staticClass:"size26 pt5 pl20"},[t._v("有效期至："+t._s(e.END_TIME.replace(/\//,"-").substring(0,7))+"-"+t._s(e.END_TIME.replace(/\//,"-").substring(8,11)))])]),t._m(0,!0),i("div",{staticClass:"delete",attrs:{"data-index":s},on:{click:function(i){return t.deleteItem(e)}}},[t._v("删除")])]):t._e(),3==t.filter.status&&t.isHaveTotal.total&&t.isHaveTotal.total>0?i("div",{staticClass:"bgImgCouponEnd",staticStyle:{height:"5rem",display:"flex"},on:{touchstart:t.touchStart,touchend:t.touchEnd,click:t.skip}},[i("div",{staticStyle:{color:"white",width:"6rem","text-align":"center"}},[i("div",{staticClass:"size40",staticStyle:{"padding-top":"0.625rem !important"}},[t._v("￥\n              "),i("span",{staticStyle:{"font-size":"1.7rem"}},[t._v(t._s(e.TICKET_AMOUNT))])]),i("div",{staticClass:"size24"},[t._v("满"+t._s(e.LOWEST_AMOUNT)+"可用")])]),i("div",{staticStyle:{width:"12rem","padding-left":"1.5rem",color:"#CCCCCC"}},[i("div",{staticClass:"flex-wrp flex-align-center pl20",staticStyle:{"margin-top":".5rem"}},[i("div",{staticClass:"size3 ptb20 tips"},[i("span",{staticClass:"compulsory-row-one"},[t._v(t._s(e.TICKET_REMARK))])])]),i("div",{staticClass:"size26 pt5 pl20"},[t._v("有效期至："+t._s(e.END_TIME.replace(/\//,"-").substring(0,7))+"-"+t._s(e.END_TIME.replace(/\//,"-").substring(8,11)))])]),t._m(1,!0),i("div",{staticClass:"delete",attrs:{"data-index":s},on:{click:function(i){return t.deleteItem(e)}}},[t._v("删除")])]):t._e()])}),0)]):t._e(),i("load-more",{ref:"loadMore",attrs:{handler:t.fetchMore,noMore:"new",noResult:"new"}}),i("div",{staticStyle:{height:"4rem"}})],1)},n=[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{width:"4rem"}},[e("img",{staticStyle:{width:"70px",height:"64px",position:"absolute",right:"3vw","margin-top":"10px"},attrs:{src:i("yQ9F")}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{width:"4rem"}},[e("img",{staticStyle:{width:"70px",height:"58px",position:"absolute",right:"3vw","margin-top":"12px"},attrs:{src:i("WdUG")}})])}];s._withStripped=!0;var a={render:s,staticRenderFns:n};e.a=a},WdUG:function(t,e,i){t.exports=i.p+"img/guoQi.8e9011e.png"},jOOb:function(t,e,i){var s=i("S+CF");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);i("rjj0")("540ee1c3",s,!1,{sourceMap:!1})},tI9c:function(t,e,i){t.exports=i.p+"img/ableuse.ac3983f.png"},yQ9F:function(t,e,i){t.exports=i.p+"img/useEndImg.cc6122c.png"}});