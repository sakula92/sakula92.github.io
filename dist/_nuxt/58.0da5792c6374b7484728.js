webpackJsonp([58],{"2Yw2":function(t,e,a){"use strict";var n=a("Dd8w"),i=a.n(n),o=a("Xxa5"),r=a.n(o),s=a("exGp"),c=a.n(s),u=a("NYxO"),d=a("y1vT"),f=a.n(d),p=a("DHvs"),l=a("hxf6");e.a={data:function(){return{phoneNumber:"",wxdata:{},focusIndex:1,total_fee:null,isRealFee:!1,real_fee:"",cash_fee:0,isSaving:!1,discount:!1,redpacket:!1,coupon:!1,isShowRedpackets:!1,isShowCoupons:!1,order:{},oldFee:null,newFee:null}},asyncData:function(){var t=c()(r.a.mark(function t(e){var a,n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.b.get("/v2/shop/"+e.query.shop_id,null,e);case 2:if(a=t.sent,n=a.data,200!==a.status||"SUCCESS"!==n.code){t.next=9;break}return t.abrupt("return",{shop:n.shop});case 9:return t.abrupt("return",e.error({statusCode:404,message:"店铺不存在或已停用"}));case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),head:function(){return{title:this.shop.title+"收银台"}},computed:i()({},Object(u.mapState)({config:function(t){return t.config},user:function(t){return t.user.info}}),{isEnabledPay:function(){return!this.isSaving&&parseFloat(this.total_fee)>0}}),components:{LoginZybankApp:l.a},mounted:function(){console.log(this.shop,"shop"),this.loginapp_payfun()},watch:{coupon:function(){this.discountFee()},redpacket:function(){this.discountFee()},total_fee:function(t,e){this.coupon=!1,this.redpacket=!1,this.discountFee()},real_fee:function(){this.coupon=!1,this.redpacket=!1,this.discountFee()}},methods:{onlyForCurrency:function(t){var e=t.keyCode?t.keyCode:t.which;!(e<48||e>57)||46===e&&-1==this.total_fee.indexOf(".")||t.preventDefault(),null!=this.total_fee&&this.total_fee.indexOf(".")>-1&&this.total_fee.split(".")[1].length>1&&t.preventDefault()},onFocus:function(t){this.focusIndex=t},loginapp_payfun:function(){this.user.id||this.$refs.loginZybankApp.Login("app")},isValueChange:function(){0==this.isRealFee&&(this.real_fee="")},onValueChange:function(t){if(1===this.focusIndex){if(this.total_fee=this.getFloatValue(t.target.value),Number(this.total_fee)>1e5){this.total_fee=1e5;weui.topTips("金额不能大于十万")}}else{if(parseFloat(this.getFloatValue(t.target.value||"0"))>parseFloat(this.total_fee||"0"))return weui.topTips("不参与优惠金额不能大于消费总金额");this.real_fee=this.getFloatValue(t.target.value)}},getFloatValue:function(t){return t.replace(/[^\d.]/g,"").replace(/^\./g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\d+)\.(\d\d).*$/,"$1.$2")},discountFee:f()(c()(r.a.mark(function t(){var e,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(parseFloat(this.total_fee)>0)){t.next=9;break}return t.next=3,p.b.post("/shop/cashier/"+this.shop.id+"/discount",{fee:this.total_fee,real_fee:this.real_fee,redpacket_id:this.redpacket?this.redpacket.id:0,coupon_id:this.coupon?this.coupon.id:0});case 3:e=t.sent,a=e.data,200===e.status&&"SUCCESS"===a.code&&(this.discount=a.discount,this.cash_fee=a.discount.cash_fee),t.next=11;break;case 9:this.discount=!1,this.cash_fee=0;case 11:case"end":return t.stop()}},t,this)})),500),showRedPackets:function(){this.discount.redpackets&&this.discount.redpackets.length>0&&(this.isShowRedpackets=!0)},showCoupons:function(){this.discount.coupons&&this.discount.coupons.length>0&&(this.isShowCoupons=!0)},chooseRedPacket:function(t){this.redpacket=t,this.isShowRedpackets=!1},chooseCoupon:function(t){this.coupon=t,this.isShowCoupons=!1},onPay:function(){var t=c()(r.a.mark(function t(){var e,a,n,i,o,s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this,console.log(e.total_fee,"+++"),2!=e.user.login_status){t.next=6;break}Object(p.d)()?window.demo&&window.demo.openRealName():Object(p.e)()&&(window.location.href="objc://openRealName:/"),t.next=28;break;case 6:if(!(parseFloat(e.total_fee)<=0)){t.next=8;break}return t.abrupt("return",weui.topTips("请输入付款金额"));case 8:return e.isSaving=!0,t.next=11,p.b.post("/shop/cashier/"+this.shop.id,{fee:e.total_fee,real_fee:e.real_fee,redpacket_id:e.redpacket?e.redpacket.id:0,coupon_id:e.coupon?e.coupon.id:0});case 11:if(a=t.sent,n=a.data,i=a.status,e.isSaving=!1,200!==i||"SUCCESS"!==n.code){t.next=27;break}if(!Object(p.i)()){t.next=21;break}e.isSaving=!1,location.href="/payment?id="+n.order_id,t.next=25;break;case 21:return t.next=23,p.b.post("/user/order/pay",{order_id:n.order_id});case 23:"SUCCESS"===(o=t.sent).data.code?(e.isSaving=!1,e.order=o.data,e.$nextTick(function(){document.getElementById("zybank").submit()})):(e.isSaving=!1,weui.alert("支付失败"));case 25:t.next=28;break;case 27:200===i&&"3001"===n.code&&Object(p.i)()?weui.confirm("请先绑定您的手机号",{title:"温馨提示",buttons:[{label:"取消",type:"default"},{label:"确定",type:"primary",onClick:function(){e.$router.push("/bindphone")}}]}):((s=n.msg+",金额不能大于十万")&&weui.topTips(s),-1==n.auth&&e.loginapp_payfun());case 28:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}}},Ds5F:function(t,e,a){"use strict";var n=a("Dd8w"),i=a.n(n),o=a("Xxa5"),r=a.n(o),s=a("exGp"),c=a.n(s),u=a("DHvs"),d=a("NYxO");e.a={asyncData:function(){var t=c()(r.a.mark(function t(e){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={btnText:"登录",backUrl:e.query.url,loginParam:{},loginResponseData:{}},t.abrupt("return",a);case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),computed:i()({},Object(d.mapState)({session:function(t){return t.session}})),mounted:function(){var t=this;window.loginForResponse=function(e,a,n,i){t.loginResponseData={type:"app",url:e,data:a,sign:n,avatar:i},t.getUserInfoForZyBank()},window.wechatLoginForResponse=function(e,a){t.loginResponseData={type:"wechat",data:e,sign:a},t.getUserInfoForZyBank()},window.onResponseError=function(){weui.toast("未正常登录,请重试")}},methods:{setUserCity:function(){var t=c()(r.a.mark(function t(e,a,n){var i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this,t.next=3,u.b.get("/zybank/loginLogs",{city_id:e,type:a,status:n});case 3:i=t.sent,i.data;case 5:case"end":return t.stop()}},t,this)}));return function(e,a,n){return t.apply(this,arguments)}}(),getUserInfoForZyBank:function(){var t=c()(r.a.mark(function t(){var e,a,n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.b.post("/zybank/setlogin",this.loginResponseData);case 2:if(e=t.sent,a=e.data,200!==e.status||"SUCCESS"!==a.code){t.next=13;break}return t.next=8,this.$store.dispatch("user/getUser");case 8:this.userinfo=this.$store.state.user.info,n=window.localStorage.getItem("current_city")?JSON.parse(window.localStorage.getItem("current_city")):{},this.setUserCity(n.city_id||"","0",n.status||"2"),t.next=14;break;case 13:weui.toast("登录失败");case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),Login:function(){var t=c()(r.a.mark(function t(e){var a,n,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=location.href,t.next=3,u.b.get("/zybank/prelogin",{url:a});case 3:n=t.sent,i=n.data,200===n.status&&"SUCCESS"===i.code&&(this.loginParam=i.data),t.t0=e,t.next="app"===t.t0?10:"wechat"===t.t0?12:14;break;case 10:return Object(u.d)()?window.demo.clickOnAndroid(this.loginParam.loginUrl,this.loginParam.crypted,this.loginParam.sign):Object(u.e)()&&(window.location.href="objc://loginBank:/,"+this.loginParam.loginUrl+","+this.loginParam.crypted+","+this.loginParam.sign),t.abrupt("break",14);case 12:return Object(u.d)()?window.demo.wechatLoginOnAndroid():Object(u.e)()&&(window.location.href="objc://wechatLogin:/"),t.abrupt("break",14);case 14:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}}},Ldk8:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,".login-bounce[data-v-01f91858]{width:17.5rem;height:14.6875rem}.login_img[data-v-01f91858]{width:3.125rem;height:3.125rem}",""])},fYTP:function(t,e,a){"use strict";var n=function(){var t=this.$createElement;return(this._self._c||t)("div")};n._withStripped=!0;var i={render:n,staticRenderFns:[]};e.a=i},hxf6:function(t,e,a){"use strict";var n=a("Ds5F"),i=a("fYTP"),o=!1;var r=function(t){o||a("n0MW")},s=a("VU/8")(n.a,i.a,!1,r,"data-v-01f91858",null);s.options.__file="components/LoginZybankApp.vue",e.a=s.exports},las8:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pd30"},[a("div",{staticStyle:{width:"100%","text-align":"center"}},[a("img",{staticStyle:{width:"100px",height:"90px"},attrs:{src:t.shop.thumb}}),a("p",{staticStyle:{"font-size":"14px",margin:"2vw 0",color:"#666666"}},[t._v("你正在向"+t._s(t.shop.title)+"付款")])]),a("div",{staticClass:"bg-white pd20 box-shadow relative",staticStyle:{width:"100%",height:"115px",margin:"auto"}},[a("div",{staticClass:"flex-wrp flex-align-center border-radius5 size32 ptb30 plr15",staticStyle:{"border-bottom":"1px solid #CCCCCC"}},[a("div",{staticClass:"color2",staticStyle:{"font-weight":"bold"}},[t._v("消费总金额(元)")]),a("div",{staticClass:"flex-item flex-wrp color4 relative input-box",class:{focus:1===t.focusIndex}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.total_fee,expression:"total_fee"}],staticClass:"flex-item text-right size32 bg-none nbr",attrs:{type:"number",autofocus:"autofocus",placeholder:"请询问服务员后输入"},domProps:{value:t.total_fee},on:{focus:function(e){return t.onFocus(1)},input:[function(e){e.target.composing||(t.total_fee=e.target.value)},t.onValueChange],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onPay(e)},keypress:t.onlyForCurrency}})])]),a("div",{staticClass:"ptb30 plr5",staticStyle:{"font-size":"0.75rem","text-align":"center",color:"#F36E23","line-height":"13px"}},[t._v("\n            收银台买单仅限于到店支付,非抢购和团购活动。\n        ")])]),a("div",{staticClass:"weui-btn_area",staticStyle:{"margin-top":"40px"}},[a("base-button",{attrs:{loading:t.isSaving,enabled:t.isEnabledPay},on:{click:t.onPay}},[t._v("支付")])],1),a("login-zybank-app",{ref:"loginZybankApp"}),a("form",{staticStyle:{display:"none"},attrs:{action:t.order.url,method:"post",id:"zybank"}},[a("input",{attrs:{type:"hidden",id:"plain",name:"Plain"},domProps:{value:t.order.data&&t.order.data.Plain}}),a("input",{attrs:{type:"hidden",name:"Signature"},domProps:{value:t.order.data&&t.order.data.Signature}})])],1)};n._withStripped=!0;var i={render:n,staticRenderFns:[]};e.a=i},n0MW:function(t,e,a){var n=a("Ldk8");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a("rjj0")("5b0a07a5",n,!1,{sourceMap:!1})},nWS0:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("2Yw2"),i=a("las8"),o=!1;var r=function(t){o||a("tY3M")},s=a("VU/8")(n.a,i.a,!1,r,"data-v-07f0dca3",null);s.options.__file="pages/shop/cashier.vue",e.default=s.exports},tY3M:function(t,e,a){var n=a("wNQD");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a("rjj0")("71c57044",n,!1,{sourceMap:!1})},wNQD:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,'.model[data-v-07f0dca3]{width:12.5rem;margin:0 auto;padding:1.375rem 0;position:relative;margin-top:9.375rem;background-color:#fff;border-radius:.3125rem}.input_row[data-v-07f0dca3]{padding:0 0 0 .3125rem;text-align:center}.input_row>input[data-v-07f0dca3]{border:.03125rem solid #ddd;height:1.25rem;font-size:.75rem}.btn1[data-v-07f0dca3],.btn2[data-v-07f0dca3]{display:inline-block;height:1.5625rem;width:3.125rem;margin:.625rem .625rem 0}.model_span[data-v-07f0dca3]{position:absolute;top:-.46875rem;right:-.3125rem;width:1.5625rem;height:1.5625rem;background-color:#fff;border-radius:50%;text-align:center}.focus .split[data-v-07f0dca3]{position:absolute;top:0;right:0;width:.09375rem;-webkit-animation:flash-data-v-07f0dca3 1s infinite;animation:flash-data-v-07f0dca3 1s infinite}.focus .tips[data-v-07f0dca3]{position:absolute;right:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}@-webkit-keyframes flash-data-v-07f0dca3{0%{opacity:0}to{opacity:1}}@keyframes flash-data-v-07f0dca3{0%{opacity:0}to{opacity:1}}.cash-fee[data-v-07f0dca3]{border-top-style:dashed}.cash-fee[data-v-07f0dca3]:after,.cash-fee[data-v-07f0dca3]:before{position:absolute;display:block;content:"";width:.9375rem;height:.9375rem;background:#f2f2f2;border-radius:50%;top:-.46875rem}.cash-fee[data-v-07f0dca3]:before{left:-1.40625rem}.cash-fee[data-v-07f0dca3]:after{right:-1.40625rem}.key-btn[data-v-07f0dca3]{border:.03125rem solid #e5e5e5;border-width:.03125rem .03125rem 0 0}.back-btn[data-v-07f0dca3]:active,.key-btn[data-v-07f0dca3]:active{background:#ddd!important}.back-btn[data-v-07f0dca3]{border-top:.03125rem solid #e5e5e5!important}.dialog[data-v-07f0dca3]{z-index:1001}.dialog .weui-cells[data-v-07f0dca3]{max-height:70vh}.input-box[data-v-07f0dca3]{text-align:right}.input-box input[data-v-07f0dca3]{width:80%}',""])},y1vT:function(t,e,a){(function(e){var a="Expected a function",n=NaN,i="[object Symbol]",o=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,d="object"==typeof e&&e&&e.Object===Object&&e,f="object"==typeof self&&self&&self.Object===Object&&self,p=d||f||Function("return this")(),l=Object.prototype.toString,h=Math.max,g=Math.min,v=function(){return p.Date.now()};function b(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function m(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&l.call(t)==i}(t))return n;if(b(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=b(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var a=s.test(t);return a||c.test(t)?u(t.slice(2),a?2:8):r.test(t)?n:+t}t.exports=function(t,e,n){var i,o,r,s,c,u,d=0,f=!1,p=!1,l=!0;if("function"!=typeof t)throw new TypeError(a);function y(e){var a=i,n=o;return i=o=void 0,d=e,s=t.apply(n,a)}function w(t){var a=t-u;return void 0===u||a>=e||a<0||p&&t-d>=r}function k(){var t=v();if(w(t))return x(t);c=setTimeout(k,function(t){var a=e-(t-u);return p?g(a,r-(t-d)):a}(t))}function x(t){return c=void 0,l&&i?y(t):(i=o=void 0,s)}function _(){var t=v(),a=w(t);if(i=arguments,o=this,u=t,a){if(void 0===c)return function(t){return d=t,c=setTimeout(k,e),f?y(t):s}(u);if(p)return c=setTimeout(k,e),y(u)}return void 0===c&&(c=setTimeout(k,e)),s}return e=m(e)||0,b(n)&&(f=!!n.leading,r=(p="maxWait"in n)?h(m(n.maxWait)||0,e):r,l="trailing"in n?!!n.trailing:l),_.cancel=function(){void 0!==c&&clearTimeout(c),d=0,i=u=o=c=void 0},_.flush=function(){return void 0===c?s:x(v())},_}}).call(e,a("DuR2"))}});