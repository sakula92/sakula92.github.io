webpackJsonp([75],{"0NhW":function(t,e,i){"use strict";i.d(e,"a",function(){return h});var s=i("Xxa5"),n=i.n(s),r=i("mvHQ"),o=i.n(r),a=i("exGp"),l=i.n(a),c=i("DHvs"),u=function(){var t=l()(n.a.mark(function t(e,i,s,r){var a,l,u,h;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("http--/weixin/tools/get_ticket"),t.next=3,c.b.get("/weixin/tools/get_ticket",{url:r||location.href});case 3:a=t.sent,l=a.data,u=a.status,console.log(u),200===u&&"SUCCESS"===l.code&&(h={appId:l.appId,timestamp:l.timestamp,nonceStr:l.nonceStr,signature:l.signature,jsApiList:e},s&&(s.link=l.url),console.log(o()(h)+"=====weixingetconfig.js"),c.o.setConfig(h),c.o.ready().then(function(){"1"===i?(c.o.hideAllNonBaseMenuItem(),c.o.showMenuItems({menuList:["menuItem:share:appMessage","menuItem:share:timeline","menuItem:share:qq","menuItem:share:QZone"]}),c.o.setShareNew(s)):c.o.hideAllNonBaseMenuItem()}));case 8:case"end":return t.stop()}},t,this)}));return function(e,i,s,n){return t.apply(this,arguments)}}(),h=function(t,e,i,s){console.log(t),console.log("wxSetConfig"),console.log(c.o),u(t,e,i,s)}},FJiM:function(t,e){t.exports="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},GY2l:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"overflow-hidden"},[t.isShowTips?s("div",{staticClass:"flex-wrp plr30 ptb20 flex-align-center bg-pink"},[s("i",{staticClass:"i i-cash-bag color3 size32"}),s("div",{staticClass:"flex-item color2 size30 pl5"},[t._v("分享此商品，立享￥"+t._s(t.buying.bounty)+"奖励金")]),s("div",{staticClass:"border-radius5 ptb10 plr30 size26 btn-main",on:{click:t.toggleRule}},[t._v("分享规则")])]):t._e(),s("canvas",{staticClass:"hide",attrs:{id:"post_canvas"}},[t._v("Your browser does not support the canvas element.")]),s("img",{staticClass:"w100",staticStyle:{background:"url('../../assets/images/post_building.gif') no-repeat center center"},attrs:{id:"post_img",src:i("FJiM")}}),t.isShowRule?s("div",{staticClass:"fixed-bottom fullHeight bg-white flex-wrp flex-cell weui-animate-slide-up"},[s("div",{staticClass:"flex-item overflow-auto-y pd30",domProps:{innerHTML:t._s(t.rule)}}),s("div",{staticClass:"weui-btn-area"},[s("base-button",{on:{click:t.toggleRule}},[t._v("关闭")])],1)]):t._e()])};s._withStripped=!0;var n={render:s,staticRenderFns:[]};e.a=n},Qp18:function(t,e,i){"use strict";var s=i("d7EF"),n=i.n(s),r=i("Zrlr"),o=i.n(r),a=i("wxAW"),l=i.n(a),c=function(){function t(e,i,s){o()(this,t),this.isDefault=e.isDefault,this.platformName=e.platformName,this.banner=e.banner,this.title=e.title,this.oldPrice=e.oldPrice,this.nowPrice=e.nowPrice,this.vipPrice=e.vipPrice,this.overtime=e.overtime,this.postUrl=e.postUrl,this.codeWidth=e.codeWidth,this.codeTop=e.codeTop,this.codeLeft=e.codeLeft,this.codeUrl=e.codeUrl,this.getTextLength=this.getTextLength.bind(this),this.cutString=this.cutString.bind(this),this.myDrawText=this.myDrawText.bind(this),this.drawPrice=this.drawPrice.bind(this),this.drawDefaultPost=this.drawDefaultPost.bind(this),this.drawCustomPost=this.drawCustomPost.bind(this),this.drawPost=this.drawPost.bind(this),this.canvas=i,this.img=s}return l()(t,[{key:"getTextLength",value:function(t){for(var e=t.length,i=0,s=0;s<e;s++)t.charCodeAt(s)>128?i+=2:i+=1;return i}},{key:"cutString",value:function(t,e){for(var i=t.length,s=i,n=0,r=0;r<i;r++)if(t.charCodeAt(r)>128){if(!(n+2<e)){s=r;break}n+=2}else{if(!(n+1<e)){s=r;break}n+=1}return s}},{key:"myDrawText",value:function(t){var e=n()(t,7),i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6];i.font=s,i.fillStyle=r,i.textAlign=o,i.fillText(c,a,l)}},{key:"drawPrice",value:function(t){var e=n()(t,7),i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6];if(i.fillStyle="#f0f0f0",i.fillRect(0,s+r+o,l,a),this.vipPrice){i.strokeStyle="#ddd",i.beginPath(),i.moveTo(l/2,s+r+o+10*c),i.lineWidth=1,i.lineCap="round",i.lineTo(l/2,s+r+o+a-10*c),i.stroke(),this.myDrawText([i,"bold "+13*c+"px 微软雅黑","#333","left",30*c,s+r+o+18*c,"原价￥"]),this.myDrawText([i,"bold "+13*c+"px 微软雅黑","#ff4622","left",68*c,s+r+o+18*c,this.oldPrice]),this.myDrawText([i,"bold "+13*c+"px 微软雅黑","#333","left",30*c,s+r+o+40*c,"抢购价￥"]),this.myDrawText([i,"bold "+23*c+"px 微软雅黑","#ff4622","left",85*c,s+r+o+40*c,this.nowPrice]);var u=10*this.getTextLength(this.vipPrice)*c+5*c;this.myDrawText([i,"bold "+13*c+"px 微软雅黑","#333","right",l-30*c-u,s+r+o+40*c,"会员价￥"]),this.myDrawText([i,"bold "+20*c+"px 微软雅黑","#ff4622","right",l-30*c,s+r+o+40*c,this.vipPrice])}else{var h=13*this.getTextLength(this.nowPrice)*c;this.myDrawText([i,"bold "+13*c+"px 微软雅黑","#333","left",l/2-56*c,s+r+o+18*c,"原价￥"]),this.myDrawText([i,"bold "+13*c+"px 微软雅黑","#ff4622","left",l/2-18*c,s+r+o+18*c,this.oldPrice]),this.myDrawText([i,"bold "+13*c+"px 微软雅黑","#333","center",l/2-52*c/2-5*c,s+r+o+40*c,"抢购价￥"]),this.myDrawText([i,"bold "+23*c+"px 微软雅黑","#ff4622","center",l/2+h/2-5*c,s+r+o+40*c,this.nowPrice])}}},{key:"canvasToImg",value:function(t){var e=t.toDataURL();this.img.setAttribute("src",e),t.style.display="none"}},{key:"drawCustomPost",value:function(t,e,i){var s=new Image;s.crossOrigin="anonymous",s.src=this.postUrl;var n=this;s.onload=function(){var r=t.offsetWidth,o=r*s.height/s.width;if(e.width=r,e.height=o,i.drawImage(s,0,0,r,o),n.codeUrl){var a=new Image;a.src=n.codeUrl;var l=r*n.codeLeft/750,c=r*n.codeTop/750,u=r*n.codeWidth/750;a.onload=function(){i.drawImage(a,l,c,u,u),n.canvasToImg(e)}}}}},{key:"drawDefaultPost",value:function(t,e,i){var s=window.devicePixelRatio||1,n=t.offsetWidth*s,r=n-30*s*2,o=35*s,a=.426*n,l=26*Math.ceil(7*this.getTextLength(this.title)*s/r)*s+16*s,c=48*s,u=70*s+.4969*n,h=Math.ceil(o+a+l+c+u);e.width=n,e.height=h,i.fillStyle="#fff",i.fillRect(0,0,n,h),this.myDrawText([i,"bold "+15*s+"px 微软雅黑","#333","center",n/2,23*s,this.platformName]);for(var d=this.title,f=this.cutString(this.title,r/(7*s)),p=1;this.getTextLength(d)>1;p++)this.myDrawText([i,"bold "+14*s+"px 微软雅黑","#333","center",n/2,o+a+26*p*s,d.substr(0,f).trim()]),d=d.substr(f);this.drawPrice([i,o,a,l,c,n,s]),i.strokeStyle="#999",i.beginPath(),i.moveTo(n/2-109*s,o+a+l+c+24*s),i.lineWidth=1,i.lineCap="round",i.lineTo(n/2+109*s,o+a+l+c+24*s),i.stroke(),i.fillStyle="#fff",i.fillRect(n/2-74*s,o+a+l+c+10*s,148*s,25*s);var g="抢购结束日期："+this.overtime;this.myDrawText([i,11*s+"px 微软雅黑","#333","center",n/2,o+a+l+c+27*s,g]);var m=new Image;m.crossOrigin="anonymous",m.src="http://public.duduapp.net/dolife/static/images/postBg.png";var w=this;m.onload=function(){i.drawImage(m,0,o+a+l+c+35*s,n,.4969*n);var t=new Image;t.src=w.codeUrl,t.onload=function(){i.drawImage(t,.1*n,o+a+l+c+35*s+.06*n,.359375*n,.359375*n);var r=new Image;r.crossOrigin="anonymous",r.src=w.banner,r.onload=function(){i.drawImage(r,0,35*s,n,a),w.canvasToImg(e)}}};this.myDrawText([i,11*s+"px 微软雅黑","#999","center",n/2,h-25*s,"长按识别或扫描二维码抢购此商品"])}},{key:"drawPost",value:function(){var t=document.body,e=this.canvas.getContext("2d");this.isDefault?this.drawDefaultPost(t,this.canvas,e):this.drawCustomPost(t,this.canvas,e)}}]),t}();e.a={draw:function(t,e,i){new c(t,e,i).drawPost()}}},SAsb:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("ngKh"),n=i("GY2l"),r=i("VU/8")(s.a,n.a,!1,null,null,null);r.options.__file="pages/buying/share.vue",e.default=r.exports},Zrlr:function(t,e,i){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},ngKh:function(t,e,i){"use strict";var s=i("Dd8w"),n=i.n(s),r=i("Xxa5"),o=i.n(r),a=i("exGp"),l=i.n(a),c=i("PJh5"),u=i.n(c),h=i("NYxO"),d=i("DHvs"),f=i("0NhW"),p=i("Qp18");e.a={data:function(){return{isShowRule:!1}},head:{title:"抢购分享"},asyncData:function(){var t=l()(o.a.mark(function t(e){var i,s,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.b.get("/buying/"+e.query.id+"/poster",null,e);case 2:if(i=t.sent,s=i.data,200!==(n=i.status)||"SUCCESS"!==s.code){t.next=9;break}return t.abrupt("return",{buying:s.poster.buying,rule:s.poster.rule,postConfig:{isDefault:!s.poster.customize,codeUrl:s.poster.qrcode.url,platformName:e.store.state.config.siteConfig.sitename,banner:Object(d.j)(s.poster.buying.thumb),title:s.poster.buying.title,oldPrice:s.poster.buying.price,nowPrice:s.poster.buying.fee,vipPrice:s.poster.buying.vip_info?s.poster.buying.vip_info.fee:"",overtime:u()(s.poster.buying.time_end).format("YYYY-MM-DD"),postUrl:s.poster.customize?Object(d.j)(s.poster.customize.url):"",codeWidth:s.poster.qrcode.w,codeTop:s.poster.qrcode.y,codeLeft:s.poster.qrcode.x}});case 9:return t.abrupt("return",e.error(n,{message:s.msg}));case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),computed:n()({},Object(h.mapState)({config:function(t){return t.config},user:function(t){return t.user.info}}),{isShowTips:function(){return!(parseFloat(this.buying.bounty||0)<=0)&&(0!==this.config.buying_distribution_status&&!(2===this.config.buying_distribution_status&&!this.user.is_vip))}}),mounted:function(){if(p.a.draw(this.postConfig,document.getElementById("post_canvas"),document.getElementById("post_img")),Object(d.i)()){Object(f.a)(["hideAllNonBaseMenuItem"])}},methods:{toggleRule:function(){this.isShowRule=!this.isShowRule}}}},wxAW:function(t,e,i){"use strict";e.__esModule=!0;var s=function(t){return t&&t.__esModule?t:{default:t}}(i("C4MV"));e.default=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,s.default)(t,n.key,n)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}()}});