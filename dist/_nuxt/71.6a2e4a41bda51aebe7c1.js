webpackJsonp([71],{"/eco":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("RQ5W"),n=i("TOHx"),a=i("VU/8")(s.a,n.a,!1,null,null,null);a.options.__file="pages/gift/index.vue",t.default=a.exports},DFfH:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,".fixed-top[data-v-502cdb8b]{position:fixed;top:0;z-index:1002}.convenient-box[data-v-502cdb8b]{overflow-x:auto;overflow-y:hidden;background:#fff;padding-left:.9375rem;padding-bottom:.625rem;width:100vw;white-space:nowrap;-webkit-overflow-scrolling:touch}.convenient-box[data-v-502cdb8b]::-webkit-scrollbar{display:none}.convenient-filter[data-v-502cdb8b]{height:1.875rem;line-height:1.875rem;border-radius:.9375rem;font-size:.8125rem;color:#666;letter-spacing:0;text-align:center;background:#f5f5f5;padding:0 .9375rem;display:inline-block;margin-right:.625rem}.convenient-filter-active[data-v-502cdb8b]{color:#f56d23}#expendList[data-v-502cdb8b]{overflow-y:auto}#expendList[data-v-502cdb8b] ::-webkit-scrollbar{-webkit-appearance:none}.filter-wrap[data-v-502cdb8b]{position:relative;z-index:1002;top:-2.5rem}.filter-box[data-v-502cdb8b]{position:absolute;top:0;left:0}.filter-box-comix[data-v-502cdb8b]{position:fixed;left:0;top:2rem}.filter-cate[data-v-502cdb8b]:first-child{border-left:none}.ischeck[data-v-502cdb8b]{color:#fff;background-color:#f56d23}.nocheck[data-v-502cdb8b]{color:#333;border:.03125rem solid #ddd}input[data-v-502cdb8b]{opacity:0}.cate-active[data-v-502cdb8b]{color:#f56d23}.dish[data-v-502cdb8b]{border-radius:.25rem;padding-top:.1875rem;padding-bottom:.1875rem}.dish label[data-v-502cdb8b]{position:relative}.dish label input[data-v-502cdb8b]{position:absolute;left:0}.btn1[data-v-502cdb8b]{width:10.5rem;height:2.0625rem;border:.03125rem solid #d5d5d6;border-radius:.3125rem;background-color:#666;color:#fff}.border-blue[data-v-502cdb8b]{border:.03125rem solid #18baf9}.btn2[data-v-502cdb8b]{width:10.5rem;height:2.0625rem;border-radius:.3125rem;color:#fff;background-color:#17cc85}.rotate180[data-v-502cdb8b]{-webkit-transform:rotate(180deg);transform:rotate(180deg);position:relative;top:-.125rem}.width96[data-v-502cdb8b]{width:96%}.width160[data-v-502cdb8b]{min-width:4.6875rem}.width50[data-v-502cdb8b]{width:50%}.height80[data-v-502cdb8b]{height:2.5rem}.lineheight80[data-v-502cdb8b]{line-height:2.5rem}.textcenter[data-v-502cdb8b]{text-align:center}.bordertop1[data-v-502cdb8b]{border-top:.03125rem solid #ccc}.borderleft1[data-v-502cdb8b]{border-left:.03125rem solid #ccc}.borderbottom1[data-v-502cdb8b]{border-bottom:.03125rem solid #eee}.w92[data-v-502cdb8b]{width:92%;margin-left:4%}.switch[data-v-502cdb8b]{padding-top:.25rem}",""])},EoCj:function(e,t,i){"use strict";var s=i("bOdI"),n=i.n(s),a=i("woOf"),r=i.n(a),o=i("Xxa5"),c=i.n(o),l=i("exGp"),d=i.n(l),h=i("Dd8w"),f=i.n(h),u=i("NYxO"),p=i("Fd2+"),v=i("DHvs");t.a={data:function(){return{isfix:!1,show:!0,isclose:!1,expend:[],fexpend:[],isshow:!1,cuisine:[],open_time:[],shop_capacity:[],shop_age:[],filter_index:0,category_id:0,newAgentCity:{},couponSwitch:!1,coupon:0,conFilters:[{label:"500米以内",key:"distance",value:"500"},{label:"1km以内",key:"distance",value:"1000"},{label:"快餐小吃",key:"cid",value:""},{label:"饮品",key:"cid",value:""},{label:"豫菜",key:"cuisine",value:"豫菜"},{label:"川菜",key:"cuisine",value:"川菜"}],conFilter:""}},props:{filters:{type:Array,required:!0},filter:{type:Object,required:!0},curlabel:{type:String},cityInfo:{type:Object},showCoupon:{type:Boolean,default:!1},showConvenient:{type:Boolean,default:!1}},components:{VanSwitch:p.o},mounted:function(){this.newAgentCity=window.sessionStorage.getItem("agent_city")?JSON.parse(window.sessionStorage.getItem("agent_city")):this.agentCity,this.conFiltersQry()},computed:f()({},Object(u.mapState)({agentCity:function(e){return e.session.agentCity},currentCity:function(e){return e.session.currentCity}}),{label:function(){for(var e=[],t=0;t<this.filters.length;t++)e.push(this.filters[t].label);return t==this.filters.length&&this.curlabel&&(e[1]=this.curlabel),e[0]="附近",e}}),methods:{conFiltersQry:function(){var e=d()(c.a.mark(function e(){var t,i;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.b.get("/v3/extrafilter",{});case 2:t=e.sent,2e5===(i=t.data).code&&(this.$set(this.conFilters[2],"value",i.filter[0].value),this.$set(this.conFilters[3],"value",i.filter[1].value));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),switchToggle:function(){this.coupon=0===this.coupon?1:0,console.log(this.coupon)},close:function(){this.show=!1,this.$emit("close2")},onFetch:function(e){this.category_id=e,this.show=!0},touchmove:function(){this.show=!1},showFilter:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(v.l)("fm_filterClick",{},{eventType:e.label}),document.documentElement.scrollTop=568,this.$emit("scrollFixed",e),0==t&&(this.filter_index=i),"filter"===e.key?(this.expend=[],this.show=!0,this.isshow?(this.isshow=!1,this.$emit("close2")):(this.fexpend.length>0||this.fexpend.push(e),this.isshow=!0)):(this.show=!0,this.isshow=!1,e.items?this.expend.length>t?(this.expend=this.expend.slice(0,t+1),this.expend.every(function(t){return t.key===e.key&&t.value===e.value})?(this.$emit("close2"),this.expend.pop()):this.expend[t]=e):this.expend.push(e):(this.expend=[],this.label[this.filter_index]=e.label,"district_id"===e.key?(this.filter.distance="",this.conFilter=""):this.conFilter.key===e.key&&(this.conFilter=""),this.$emit("filter",r()({},this.filter,n()({},e.key,e.value))))),console.log("......this.isshow"+this.isshow)},complexFilter:function(e){if("reset"===e){this.cuisine=[],this.open_time=[],this.shop_capacity=[],this.shop_age=[];for(var t=this.fexpend[0].items,i=0;i<t.length;i++)for(var s=0;s<t[i].items.length;s++)t[i].items[s].checked&&(t[i].items[s].checked=!1)}if("submit"===e){this.cuisine=[],this.open_time=[],this.shop_capacity=[],this.shop_age=[];for(t=this.fexpend[0].items,i=0;i<t.length;i++)for(s=0;s<t[i].items.length;s++)t[i].items[s].checked&&("cuisine"===t[i].items[s].key&&this.cuisine.indexOf(t[i].items[s].value)<0&&this.cuisine.push(t[i].items[s].value),"open_time"===t[i].items[s].key&&this.open_time.indexOf(t[i].items[s].value)<0&&this.open_time.push(t[i].items[s].value),"shop_capacity"===t[i].items[s].key&&this.shop_capacity.indexOf(t[i].items[s].value)<0&&this.shop_capacity.push(t[i].items[s].value),"shop_age"===t[i].items[s].key&&this.shop_age.indexOf(t[i].items[s].value)<0&&this.shop_age.push(t[i].items[s].value));"cuisine"===this.conFilter.key&&(this.cuisine.indexOf(this.conFilter.value)>-1?this.conFilter="":this.cuisine.push(this.conFilter.value)),this.$emit("filter",r()({},this.filter,{cuisine:this.cuisine,open_time:this.open_time,shop_capacity:this.shop_capacity,shop_age:this.shop_age,coupon:this.coupon})),this.isshow=!1}},convenientFilter:function(e){if(this.conFilter.value!==e.value){var t={district_id:0,distance:"",cid:0};if("distance"===e.key)t.distance=e.value;else{if("cuisine"===e.key){if("cuisine"===this.conFilter.key){var i=this.cuisine.indexOf(this.conFilter.value);i>-1&&this.cuisine.splice(i,1)}this.cuisine.indexOf(e.value)<0&&this.cuisine.push(e.value),t.cuisine=this.cuisine}if("cid"===e.key){if("cuisine"===this.conFilter.key){var s=this.cuisine.indexOf(this.conFilter.value);s>-1&&this.cuisine.splice(s,1)}t.cuisine=this.cuisine,t.cid=e.value}}this.conFilter=e,this.$emit("filter",r()({},this.filter,t))}}}}},RQ5W:function(e,t,i){"use strict";var s=i("woOf"),n=i.n(s),a=i("Dd8w"),r=i.n(a),o=i("Xxa5"),c=i.n(o),l=i("exGp"),d=i.n(l),h=i("NYxO"),f=i("f0Ur"),u=i("DHvs");t.a={data:function(){return{filter:{limit:10},gifts:[]}},asyncData:function(){var e=d()(c.a.mark(function e(t){var i,s;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.b.get("/filter",{typeid:5},t);case 2:if(i=e.sent,s=i.data,200!==i.status||"SUCCESS"!==s.code){e.next=7;break}return e.abrupt("return",{categories:s.filters});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),head:function(){return{title:this.config.siteConfig.sitename+"-积分商城"}},components:{BaseFilter:f.a},computed:r()({},Object(h.mapState)({config:function(e){return e.config},user:function(e){return e.user.info}})),mounted:function(){u.o.setShare(this.config.shareConfig.gift)},watch:{filter:function(){var e=this;this.$nextTick(function(){e.$refs.loadMore.$refs.infiniteLoading.$emit("$InfiniteLoading:reset")})}},methods:{onFilter:function(e){this.gifts=[],this.filter=n()({},this.filter,e)},fetchGifts:function(){var e=d()(c.a.mark(function e(){var t,i;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.b.get("/gift",n()({},this.filter,{offset:this.gifts.length}));case 2:return t=e.sent,i=t.data,this.gifts=this.gifts.concat(i.gifts||[]),e.abrupt("return",{length:this.gifts.length,isMore:(i.gifts||[]).length>=this.filter.limit});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}}},TOHx:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("base-header",[s("div",{staticClass:"flex-wrp flex-align-center bold",attrs:{slot:"title"},slot:"title"},[s("img",{staticClass:"h30 pr5",attrs:{src:i("e8nm")}}),e._v("\n            积分商城\n        ")]),s("nuxt-link",{staticClass:"block plr20 ptb15 size28",attrs:{slot:"right",to:{path:"/gift_rule"}},slot:"right"},[e._v("\n            规则\n        ")])],1),s("div",{staticClass:"flex-wrp bg-white pd30 size30"},[s("div",{staticClass:"flex-item flex-wrp flex-center"},[s("i",{staticClass:"i i-jf size36 pr10 color5"}),e._v("\n            我的积分：\n            "),s("span",{staticClass:"color3 bold"},[e._v(e._s(e.user.credit))])]),s("nuxt-link",{staticClass:"flex-item flex-wrp flex-center border-l",attrs:{to:"/user_credit"}},[s("i",{staticClass:"i i-jfgz size36 pr10 color5"}),e._v("\n            积分记录\n        ")])],1),e.categories&&e.categories.length>0?s("base-filter",{staticClass:"mt20",attrs:{filters:e.categories,filter:e.filter},on:{filter:e.onFilter}}):e._e(),s("div",{staticClass:"bg-white plr10"},e._l(e.gifts,function(t){return s("nuxt-link",{key:t.id,staticClass:"pd10 w50 inline-block",attrs:{to:{path:"/gift_"+t.id}}},[s("div",{staticClass:"relative",class:{"vip-badge":t.vip_info}},[s("base-img",{staticClass:"w100",attrs:{src:t.thumb}})],1),s("div",{staticClass:"text-nowrap size24 color37"},[e._v(e._s(t.title))]),s("div",{staticClass:"flex-wrp flex-align-center"},[t.vip_info?[s("div",{staticClass:"color3 size22"},[e._v(e._s(t.vip_info.fee)+"积分")]),s("div",{staticClass:"pl10 flex-wrp flex-end"},[s("span",{staticClass:"vip-label-lt size22"},[e._v("会员")]),s("div",{staticClass:"color5 size22 lh90 del pl10"},[e._v(e._s(t.fee))])])]:[s("div",{staticClass:"color3 size22"},[e._v(e._s(t.fee)+"积分")])],s("div",{staticClass:"flex-item"}),s("div",{staticClass:"color5 size22"},[e._v("剩余"),s("span",{staticClass:"color3 size22"},[e._v(e._s(t.stock))]),e._v("份")])],2)])}),1),s("load-more",{ref:"loadMore",attrs:{handler:e.fetchGifts}})],1)};s._withStripped=!0;var n={render:s,staticRenderFns:[]};t.a=n},e8nm:function(e,t,i){e.exports=i.p+"img/icon_gift.95f87b1.png"},f0Ur:function(e,t,i){"use strict";var s=i("EoCj"),n=i("w9w+"),a=!1;var r=function(e){a||i("i8la")},o=i("VU/8")(s.a,n.a,!1,r,"data-v-502cdb8b",null);o.options.__file="components/Base/Filter.vue",t.a=o.exports},i8la:function(e,t,i){var s=i("DFfH");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i("rjj0")("6bcf1ea5",s,!1,{sourceMap:!1})},"w9w+":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"bg-white"},[(e.expend.length>0||e.isshow)&&e.show?i("div",{staticClass:"mask",on:{click:e.close,touchmove:function(e){e.preventDefault()}}}):e._e(),e.filters.length>0?i("div",{staticClass:"bg-white flex-wrp relative ptb10 w100",class:[(e.expend.length>0||e.isshow)&&e.show?"fixed-top":""]},e._l(e.filters,function(t,s){return i("div",{staticClass:"flex-item flex-wrp ptb10 flex-center filter-cate",class:{"cate-active":e.category_id==s},on:{click:function(i){e.showFilter(t,0,s),e.onFetch(s)}}},[i("div",{staticClass:"size26 text-center compulsory-row-one w100 flex-wrp flex-align-center"},[e._v("\n        "+e._s(e.label[s])+"\n        "),e.isshow?[e.fexpend.length>0&&e.fexpend[0].key===t.key?i("i",{staticClass:"i i-arrow-down color3 size22 pl5",class:e.show?"rotate180":""}):i("i",{staticClass:"i i-arrow-down size22 pl5",class:e.category_id==s?"color3":"color5"})]:[e.expend.length>0&&e.expend[0].key===t.key?i("i",{staticClass:"i i-arrow-down color3 size22 pl5",class:e.show?"rotate180":""}):i("i",{staticClass:"i i-arrow-down size22 pl5",class:e.category_id==s?"color3":"color5"})]],2)])}),0):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showConvenient,expression:"showConvenient"}],staticClass:"convenient-box"},e._l(e.conFilters,function(t,s){return i("div",{key:s,staticClass:"convenient-filter",class:[t.value===e.conFilter.value&&t.key===e.conFilter.key?"convenient-filter-active":""],on:{click:function(i){return i.target!==i.currentTarget?null:e.convenientFilter(t)}}},[e._v("\n      "+e._s(t.label)+"\n    ")])}),0),e.expend.length>0&&e.show?i("div",{staticClass:"filter-wrap relative overflow-auto-y w100",staticStyle:{height:"368px",position:"fixed","z-index":"1002",top:"37px"},attrs:{id:"expendList"}},[i("div",{staticClass:"flex-wrp bg-white size26 w100 filter-box"},e._l(e.expend,function(t,s){return i("div",{key:s,staticClass:"flex-item",class:{"bg-grey":s+1<e.expend.length}},e._l(t.items,function(t){return i("div",{staticClass:"flex-wrp flex-align-center pd30",class:{color3:e.filter[t.key]&&e.filter[t.key]===t.value&&!e.conFilter,"bg-white":e.expend.length>s+1&&t.value===e.expend[s+1].value},on:{click:function(i){return e.showFilter(t,s+1)}}},[i("span",{staticClass:"flex-item"},[e._v(e._s(t.label))]),t.items?i("i",{staticClass:"i i-arrow-right-o size24 color4"}):e._e()])}),0)}),0)]):e._e(),e.isshow?i("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"filter-box-comix weui-animate-fade-in",staticStyle:{"z-index":"1000"}},[i("div",{staticClass:"bg-white size26 w100"},[e._l(e.fexpend[0].items,function(t,s){return i("div",{key:s,staticClass:"pl30"},[i("div",{staticClass:"ptb15 size22 color44"},[e._v(e._s(t.label))]),i("div",{staticClass:"flex-wrp flex-flow-row width96"},e._l(t.items,function(t,s){return i("span",{staticClass:"flex-wrp flex-center pl20 pr20 mb15 mr10 dish width160",class:t.checked?"ischeck":"nocheck"},[i("label",{staticClass:"size26"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.checked,expression:"n.checked"}],attrs:{type:"checkbox"},domProps:{value:t.value,checked:Array.isArray(t.checked)?e._i(t.checked,t.value)>-1:t.checked},on:{change:function(i){var s=t.checked,n=i.target,a=!!n.checked;if(Array.isArray(s)){var r=t.value,o=e._i(s,r);n.checked?o<0&&e.$set(t,"checked",s.concat([r])):o>-1&&e.$set(t,"checked",s.slice(0,o).concat(s.slice(o+1)))}else e.$set(t,"checked",a)}}}),e._v(e._s(t.label))])])}),0)])}),i("div",{staticClass:"flex-wrp flex-between mt15 plr30 w100 bordertop1"},[i("div",{staticClass:"width50 height80 lineheight80 textcenter",on:{click:function(t){return e.complexFilter("reset")}}},[e._v("重置")]),i("div",{staticClass:"width50 height80 lineheight80 textcenter color3 borderleft1",on:{click:function(t){return e.complexFilter("submit")}}},[e._v("完成")])])],2)]):e._e()])};s._withStripped=!0;var n={render:s,staticRenderFns:[]};t.a=n}});